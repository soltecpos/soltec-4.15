// script.StockCurrentAdd
// This script checks Stock Level for a sale item
//
//  # SmartPOS - Software de punto de venta touch - Creado por Alejandro Camargo retomando trabajo de c√≥digo abierto de Openbravo y smartpos. Todos los derechos Reservados 
// **************************************************************************
 
import com.openbravo.pos.forms.DataLogicSales;
import com.openbravo.pos.forms.DataLogicSystem;
import com.openbravo.data.loader.Session;
import java.util.Properties;
 
Session session = new Session(dbURL, dbUser, dbPassword);
DataLogicSales logicsale = new DataLogicSales();
logicsale.init(session);
DataLogicSystem logicsystem = new DataLogicSystem();
logicsystem.init(session);
Properties p = logicsystem.getResourceAsProperties(hostname + "/properties");
String loc = p.getProperty("location");
 
product = line.getProductID();
units = logicsale.findProductStock(loc,product,null);
multiply = 0;
 
if (line.isProductService() == true) {
    javax.swing.JOptionPane.showMessageDialog(null, "Esto es un servicio y el stock no cuenta", "Stock Check", JOptionPane.WARNING_MESSAGE);
} else {
    
    for (int i= 0; i < ticket.getLinesCount(); i++) {
        row = ticket.getLine(i);
        if (row.getProductID() == product) {
            multiply = multiply + row.getMultiply();
        }
    }
    diff = units - line.getMultiply() - multiply;
        if (diff < 0.0) {
            javax.swing.JOptionPane.showMessageDialog(null, "No hay suficiente stock en el inventario: " + loc + " - debes agregar mas stock manualmente", "Stock Check", JOptionPane.WARNING_MESSAGE);
	    return "Cancel";
	 } else {
	    return null;
	 }
 }